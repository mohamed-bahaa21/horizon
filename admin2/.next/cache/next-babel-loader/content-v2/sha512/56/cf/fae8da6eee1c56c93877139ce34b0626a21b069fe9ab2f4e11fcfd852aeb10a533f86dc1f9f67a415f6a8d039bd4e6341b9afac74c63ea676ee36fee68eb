{"ast":null,"code":"import { serialize } from 'cookie';\nimport { checkPassword, createSecureToken } from 'lib/crypto';\nimport { getAccountByUsername } from 'lib/queries';\nimport { AUTH_COOKIE_NAME } from 'lib/constants';\nimport { ok, unauthorized, badRequest } from 'lib/response';\nexport default (async (req, res) => {\n  const {\n    username,\n    password\n  } = req.body;\n\n  if (!username || !password) {\n    return badRequest(res);\n  }\n\n  const account = await getAccountByUsername(username);\n\n  if (account && (await checkPassword(password, account.password))) {\n    const {\n      user_id,\n      username,\n      is_admin\n    } = account;\n    const token = await createSecureToken({\n      user_id,\n      username,\n      is_admin\n    });\n    const cookie = serialize(AUTH_COOKIE_NAME, token, {\n      path: '/',\n      httpOnly: true,\n      sameSite: true,\n      maxAge: 60 * 60 * 24 * 365\n    });\n    res.setHeader('Set-Cookie', [cookie]);\n    return ok(res, {\n      token\n    });\n  }\n\n  return unauthorized(res);\n});","map":null,"metadata":{},"sourceType":"module"}