{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _toConsumableArray from \"D:/horizon/admin2/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"D:/horizon/admin2/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nvar _TYPE_ICONS;\n\nimport React, { useMemo, useState } from 'react';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { FixedSizeList } from 'react-window';\nimport firstBy from 'thenby';\nimport Icon from 'components/common/Icon';\nimport Tag from 'components/common/Tag';\nimport Dot from 'components/common/Dot';\nimport FilterButtons from 'components/common/FilterButtons';\nimport NoData from 'components/common/NoData';\nimport { devices } from 'components/messages';\nimport useLocale from 'hooks/useLocale';\nimport useCountryNames from 'hooks/useCountryNames';\nimport { BROWSERS } from 'lib/constants';\nimport Bolt from 'assets/bolt.svg';\nimport Visitor from 'assets/visitor.svg';\nimport Eye from 'assets/eye.svg';\nimport { stringToColor } from 'lib/format';\nimport { dateFormat } from 'lib/date';\nimport styles from './RealtimeLog.module.css';\nvar TYPE_ALL = 0;\nvar TYPE_PAGEVIEW = 1;\nvar TYPE_SESSION = 2;\nvar TYPE_EVENT = 3;\nvar TYPE_ICONS = (_TYPE_ICONS = {}, _defineProperty(_TYPE_ICONS, TYPE_PAGEVIEW, /*#__PURE__*/_jsx(Eye, {})), _defineProperty(_TYPE_ICONS, TYPE_SESSION, /*#__PURE__*/_jsx(Visitor, {})), _defineProperty(_TYPE_ICONS, TYPE_EVENT, /*#__PURE__*/_jsx(Bolt, {})), _TYPE_ICONS);\nexport default function RealtimeLog(_ref) {\n  var data = _ref.data,\n      websites = _ref.websites,\n      websiteId = _ref.websiteId;\n  var intl = useIntl();\n\n  var _useLocale = useLocale(),\n      locale = _useLocale.locale;\n\n  var countryNames = useCountryNames(locale);\n\n  var _useState = useState(TYPE_ALL),\n      filter = _useState[0],\n      setFilter = _useState[1];\n\n  var logs = useMemo(function () {\n    var pageviews = data.pageviews,\n        sessions = data.sessions,\n        events = data.events;\n    var logs = [].concat(_toConsumableArray(pageviews), _toConsumableArray(sessions), _toConsumableArray(events)).sort(firstBy('created_at', -1));\n\n    if (filter) {\n      return logs.filter(function (row) {\n        return getType(row) === filter;\n      });\n    }\n\n    return logs;\n  }, [data, filter]);\n  var uuids = useMemo(function () {\n    return data.sessions.reduce(function (obj, _ref2) {\n      var session_id = _ref2.session_id,\n          session_uuid = _ref2.session_uuid;\n      obj[session_id] = session_uuid;\n      return obj;\n    }, {});\n  }, [data]);\n  var buttons = [{\n    label: /*#__PURE__*/_jsx(FormattedMessage, {\n      id: \"label.all\",\n      defaultMessage: \"All\"\n    }),\n    value: TYPE_ALL\n  }, {\n    label: /*#__PURE__*/_jsx(FormattedMessage, {\n      id: \"metrics.views\",\n      defaultMessage: \"Views\"\n    }),\n    value: TYPE_PAGEVIEW\n  }, {\n    label: /*#__PURE__*/_jsx(FormattedMessage, {\n      id: \"metrics.visitors\",\n      defaultMessage: \"Visitors\"\n    }),\n    value: TYPE_SESSION\n  }, {\n    label: /*#__PURE__*/_jsx(FormattedMessage, {\n      id: \"metrics.events\",\n      defaultMessage: \"Events\"\n    }),\n    value: TYPE_EVENT\n  }];\n\n  function getType(_ref3) {\n    var view_id = _ref3.view_id,\n        session_id = _ref3.session_id,\n        event_id = _ref3.event_id;\n\n    if (event_id) {\n      return TYPE_EVENT;\n    }\n\n    if (view_id) {\n      return TYPE_PAGEVIEW;\n    }\n\n    if (session_id) {\n      return TYPE_SESSION;\n    }\n\n    return null;\n  }\n\n  function getIcon(row) {\n    return TYPE_ICONS[getType(row)];\n  }\n\n  function getWebsite(_ref4) {\n    var website_id = _ref4.website_id;\n    return websites.find(function (n) {\n      return n.website_id === website_id;\n    });\n  }\n\n  function getDetail(_ref5) {\n    var event_type = _ref5.event_type,\n        event_value = _ref5.event_value,\n        view_id = _ref5.view_id,\n        session_id = _ref5.session_id,\n        url = _ref5.url,\n        browser = _ref5.browser,\n        os = _ref5.os,\n        country = _ref5.country,\n        device = _ref5.device,\n        website_id = _ref5.website_id;\n\n    if (event_type) {\n      return /*#__PURE__*/_jsxs(\"div\", {\n        children: [/*#__PURE__*/_jsx(Tag, {\n          children: event_type\n        }), \" \", event_value]\n      });\n    }\n\n    if (view_id) {\n      var _getWebsite;\n\n      var domain = (_getWebsite = getWebsite({\n        website_id: website_id\n      })) === null || _getWebsite === void 0 ? void 0 : _getWebsite.domain;\n      return /*#__PURE__*/_jsx(\"a\", {\n        className: styles.link,\n        href: \"//\".concat(domain).concat(url),\n        target: \"_blank\",\n        rel: \"noreferrer noopener\",\n        children: url\n      });\n    }\n\n    if (session_id) {\n      var _intl$formatMessage;\n\n      return /*#__PURE__*/_jsx(FormattedMessage, {\n        id: \"message.log.visitor\",\n        defaultMessage: \"Visitor from {country} using {browser} on {os} {device}\",\n        values: {\n          country: /*#__PURE__*/_jsx(\"b\", {\n            children: countryNames[country] || intl.formatMessage({\n              id: 'label.unknown',\n              defaultMessage: 'Unknown'\n            })\n          }),\n          browser: /*#__PURE__*/_jsx(\"b\", {\n            children: BROWSERS[browser]\n          }),\n          os: /*#__PURE__*/_jsx(\"b\", {\n            children: os\n          }),\n          device: /*#__PURE__*/_jsx(\"b\", {\n            children: (_intl$formatMessage = intl.formatMessage(devices[device])) === null || _intl$formatMessage === void 0 ? void 0 : _intl$formatMessage.toLowerCase()\n          })\n        }\n      });\n    }\n  }\n\n  function getTime(_ref6) {\n    var created_at = _ref6.created_at;\n    return dateFormat(new Date(created_at), 'pp', locale);\n  }\n\n  function getColor(row) {\n    var session_id = row.session_id;\n    return stringToColor(uuids[session_id] || \"\".concat(session_id).concat(getWebsite(row)));\n  }\n\n  var Row = function Row(_ref7) {\n    var _getWebsite2;\n\n    var index = _ref7.index,\n        style = _ref7.style;\n    var row = logs[index];\n    return /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.row,\n      style: style,\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        children: /*#__PURE__*/_jsx(Dot, {\n          color: getColor(row)\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: styles.time,\n        children: getTime(row)\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: styles.detail,\n        children: [/*#__PURE__*/_jsx(Icon, {\n          className: styles.icon,\n          icon: getIcon(row)\n        }), getDetail(row)]\n      }), !websiteId && websites.length > 1 && /*#__PURE__*/_jsx(\"div\", {\n        className: styles.website,\n        children: (_getWebsite2 = getWebsite(row)) === null || _getWebsite2 === void 0 ? void 0 : _getWebsite2.domain\n      })]\n    });\n  };\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: styles.table,\n    children: [/*#__PURE__*/_jsx(FilterButtons, {\n      buttons: buttons,\n      selected: filter,\n      onClick: setFilter\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: styles.header,\n      children: /*#__PURE__*/_jsx(FormattedMessage, {\n        id: \"label.realtime-logs\",\n        defaultMessage: \"Realtime logs\"\n      })\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.body,\n      children: [(logs === null || logs === void 0 ? void 0 : logs.length) === 0 && /*#__PURE__*/_jsx(NoData, {}), (logs === null || logs === void 0 ? void 0 : logs.length) > 0 && /*#__PURE__*/_jsx(FixedSizeList, {\n        height: 400,\n        itemCount: logs.length,\n        itemSize: 40,\n        children: Row\n      })]\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}