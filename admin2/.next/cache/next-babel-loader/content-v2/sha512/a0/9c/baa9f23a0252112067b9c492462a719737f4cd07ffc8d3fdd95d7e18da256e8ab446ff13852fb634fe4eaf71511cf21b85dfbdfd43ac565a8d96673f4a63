{"ast":null,"code":"import moment from 'moment-timezone';\nimport { getEventMetrics } from 'lib/queries';\nimport { ok, badRequest, methodNotAllowed, unauthorized } from 'lib/response';\nimport { allowQuery } from 'lib/auth';\nconst unitTypes = ['year', 'month', 'hour', 'day'];\nexport default (async (req, res) => {\n  if (req.method === 'GET') {\n    if (!(await allowQuery(req))) {\n      return unauthorized(res);\n    }\n\n    const {\n      id,\n      start_at,\n      end_at,\n      unit,\n      tz,\n      url,\n      event_type\n    } = req.query;\n\n    if (!moment.tz.zone(tz) || !unitTypes.includes(unit)) {\n      return badRequest(res);\n    }\n\n    const websiteId = +id;\n    const startDate = new Date(+start_at);\n    const endDate = new Date(+end_at);\n    const events = await getEventMetrics(websiteId, startDate, endDate, tz, unit, {\n      url,\n      event_type\n    });\n    return ok(res, events);\n  }\n\n  return methodNotAllowed(res);\n});","map":null,"metadata":{},"sourceType":"module"}